---
fip: 21
title: FIO Staking
status: Draft
type: Functionality
author: Pawel Mastalerz <pawel@fioprotocol.io>
created: 2020-11-18
updated: 2020-02-12
---

# Abstract
This FIP proposes **FIO Staking**, an on-chain program which rewards users for participating in blockchain governance.

Fee distribution modifications:
|Recipient|Before FIP|After FIP|
|---|---|---|
|Block Producers|85%|60%|
|Staking Rewards Pool|0%|25%|

Token supply modifications:
|Token group|Before FIP|After FIP|
|---|---|---|
|Staking Rewards Reserves|0|25,000,000|
|FIO Address Giveaways|125,000,000|100,000,000|

**Total token supply increase/(decrease): 0**

Modified actions:
|Contract|Action|Endpoint|Description|
|---|---|---|---|

# Motivation
The FIO Protocol is subject to the network effect, meaning the more participants adopt it, the more useful it is to all. To accelerate the adoption, on-chain incentives for integrators in the form of TPID rewards and New User Bounties, as well as for block producers in the form of rewards and reserves are built into the FIO Chain. Currently, there are no incentives for end-users. Yet early token holders add value to the network by voting for block producers and helping the network grow.

This FIP proposes an on-chain staking functionality, which rewards users for taking an active role in the FIO Protocol governance.

# Specification
## High-level
### Staking
User can stake any available amount in their account at any point in time. To stake, the account has to have voted or proxied tokens within the preceding 30 days. The FIO tokens do not actually leave the user's account, but are instead "locked" and cannot be spent until unstaked.

When tokens are staked they cannot be transferred, used to pay a FIO Chain fee, or [locked](https://github.com/fioprotocol/fips/blob/master/fip-0006.md).

Staked tokens do count towards voting power of account.

Tokens locked via Mainnet or [FIP-6](https://github.com/fioprotocol/fips/blob/master/fip-0006.md) locks, cannot be staked.

### Staking Reward Token
When user stakes FIO Tokens they "exchange" FIO Tokens for Staking Reward Tokens (SRTs) at then current Rate of Exchange (ROE). SRT is not an actual token and cannot be trasferred. It simply acts as a representation of future Staking Rewards and is attached to the account which is staking.

### Staked Token Pool
When tokens are staked they increment the Staked Token Pool.

Currently when a fee is paid, it gets distributed as follows:
|Share|Recipient|
|---|---|
|85%|Block Producers|
|10%|Entity facilitating transaction (TPID) or, if not provided, block producers.|
|5%|Foundation|

This FIP proposes a change to the fee distribution to redirect 25% of the fee paid to the Staked Token Pool, which will be used to reward users who are staking their FIO Tokens.

After this FIP is adopted, when a fee is paid, it is distributed as follows:
|Share|Recipient|
|---|---|
|60%|Block Producers.|
|25%|Staking Rewards Pool.|
|10%|Entity facilitating transaction (TPID) or, if not provided, block producers.|
|5%|Foundation.|

In addition, if 25% of fees collected in any one day is less than 25,000 FIO, tokens from Staking Rewards Reserves will be used to increase the amount "deposited" to the Staked Token Pool to 25,000 FIO. The Staking Rewards Reserves will be capped at 25M. Once that cap is reached there will not be a minimum daily amount rediretced to Staked Token Pool. The Foundation will burn 25M FIO Tokens from Address Giveaway bucket to ensure total supply stays at 1B.

### Unstaking
User can unstake any amount in their account at any point in time. When they do, they will exchange SRTs back into FIO Tokens at then current Rate of Exchange. Since the ROE is likely to be higher at time of unstake, they will end up with more FIO Tokens than originally staked.

Since the user specifies FIO Tokens when unstaking, to determine the amount of SRTs that need to be converted, the following calculation is completed:
```
SRTs to Unstake = SRTs in Account * Unstaked Tokens/Total Tokens Staked in Account
```

The unstaked amount of FIO Tokens is locked in the account for a period of 7 days before it can be transferred or staked again.

### Rate of Exchange
ROE is determined based on the following formula:
```
ROE = Tokens in Staked Token Pool / Global SRTs
```
Tokens in Staked Token Pool is:
* incremented:
  * When users stake tokens
  * When 25% of the collected fees are deposited to Staking Rewards Pool
* decremented:
  * When users unstake tokens
  
Global SRTs is is:
* incremented:
  * When users stake tokens
* decremented:
  * When users unstake tokens
  
Because staking and un-staking increments/decrements Tokens in Staked Token Pool and Global SRTs at the then current ROE, only addition of fees to Staked Token Pool will increase the ROE.

In addition:
* ROE can only go up, so user is guaranteed at least their principal back.
* The sooner they stake the better the ROE.
* The more fees collected, the higher the ROE.
* Future ROE and therefore annualized return cannot be determined at the time of staking as it is dependent on future fees collected and tokens staked

### Rewards for TPID
When user unstakes FIO Tokens, the TPID attached to the unstake action receives 10% of the difference between tokens being unstaked and FIO Tokens received as a result of SRT to FIO Token conversion. If no TPID is provided, the 10% is redirected back to the Staked Token Pool.

## New actions
### Stake FIO Tokens
Stake FIO Tokens.
#### Contract: fio.system
#### New action: *stakefio*
#### New end point: /stake_fio_tokens
#### New fee: stake_fio_tokens, bundle-eligible (1 bundled transaction)
#### RAM increase: To be determined during implementation
#### Request body
|Parameter|Required|Format|Definition|
|---|---|---|---|
|amount|Yes|Int|Amount of SUFs to stake.|
|max_fee|Yes|Positive Int|Maximum amount of SUFs the user is willing to pay for fee. Should be preceded by [/get_fee](https://developers.fioprotocol.io/api/api-spec/reference/get-fee/get-fee) for correct value.|
|tpid|Yes|FIO Address|FIO Address of the entity which generates this transaction. TPID rewards will be paid to this address. Set to empty if not known.|
|actor|Yes|12 character string|Valid actor of signer|
##### Example
```
{
  "amount": 1000000000,
  "max_fee": 1000000000,
  "tpid": "rewards@wallet",
  "actor": "aftyershcu22"
}
```
#### Processing
* Request is validated per Exception handling.
* stake_fio_tokens fee is collected.
* RAM of signer is increased.
* Specified *amount* of FIO Tokens is designated as Staked in the Staker's Account and cannot be spent.
* *SRTs to Award* are computed: *amount* / *Rate of Exchange*
* *Staked Token Pool* count is inceremented by *amount*.
* *Global SRT* count is incremented by *SRTs to Award*.
#### Exception handling
|Error condition|Trigger|Type|fields:name|fields:value|Error message|
|---|---|---|---|---|---|
|Account not voted or proxied|Staker's account has not voted or proxied in the last 30 days.|400|"actor"|Value sent in, e.g. "aftyershcu22"|"Account has not voted or proxied in the last 30 days."|
|Invalid amount value|amount format is not valid|400|"amount"|Value sent in, e.g. "-100"|"Invalid amount value"|
|Invalid fee value|max_fee format is not valid|400|"max_fee"|Value sent in, e.g. "-100"|"Invalid fee value"|
|Fee exceeds maximum|Actual fee is greater than supplied max_fee|400|"max_fee"|Value sent in, e.g. "1000000000"|"Fee exceeds supplied maximum"|
|Insufficient balance|Available (unlocked and unstaked) balance in Staker's account is less than chain fee + *amount*|400|"max_oracle_fee"|Value sent in, e.g. "100000000000"|"Insufficient balance"|
|Invalid TPID|tpid format is not valid|400|"tpid"|Value sent in, e.g. "notvalidfioaddress"|"TPID must be empty or valid FIO address"|
#### Response body
|Parameter|Format|Definition|
|---|---|---|
|status|String|OK if successful|
|fee_collected|Int|Amount of SUFs collected as fee|
##### Example
```
{
  "status": "OK",
  "fee_collected": 2000000000
}
```

### Unstake FIO Tokens
Unstake FIO Tokens.
#### Contract: fio.system
#### New action: *unstakefio*
#### New end point: /unstake_fio_tokens
#### New fee: unstake_fio_tokens, bundle-eligible (1 bundled transaction)
#### RAM increase: To be determined during implementation
#### Request body
|Parameter|Required|Format|Definition|
|---|---|---|---|
|amount|Yes|Int|Amount of SUFs to unstake.|
|max_fee|Yes|Positive Int|Maximum amount of SUFs the user is willing to pay for fee. Should be preceded by [/get_fee](https://developers.fioprotocol.io/api/api-spec/reference/get-fee/get-fee) for correct value.|
|tpid|Yes|FIO Address|FIO Address of the entity which generates this transaction. TPID rewards will be paid to this address. Set to empty if not known.|
|actor|Yes|12 character string|Valid actor of signer|
##### Example
```
{
  "amount": 1000000000,
  "max_fee": 1000000000,
  "tpid": "rewards@wallet",
  "actor": "aftyershcu22"
}
```
#### Processing
* Request is validated per Exception handling.
* unstake_fio_tokens fee is collected.
* RAM of signer is increased.
* *SRTs to Claim* are computed: (*Staker's Account SRTs* * Unstaked *amount*) / *Total Tokens Staked in Staker's Account*
* *Staking Reward Amount* is computed: ((*SRTs to Claim* * *Rate of Exchnage*) - Unstake *amount*) * 0.9
* *TPID Reward Amount* is computed: ((*SRTs to Claim* * *Rate of Exchnage*) - Unstake *amount*) * 0.1
* Unstake *amount* is undesignated as Staked in Staker's Account and can now be spent.
* *Staking Reward Amount* is transferred from *Staked Token Pool* to Staker's Account.
* *SRTs to Claim* are decremented from Staker's Account and from *Global SRT* count.
* *Staked Token Pool* count is decremented by *amount* + *Staking Reward Amount*.
* If *tpid* was provided, *TPID Reward Amount* is awarded to the *tpid* and decremented from *Staked Token Pool*, otherwise it stays in *Staked Token Pool*.
* *amount* + *Staking Reward Amount* is [locked](https://github.com/fioprotocol/fips/blob/master/fip-0006.md) in Staker's Account for 7 days.
#### Exception handling
|Error condition|Trigger|Type|fields:name|fields:value|Error message|
|---|---|---|---|---|---|
|Account not voted or proxied|Staker's account has not voted or proxied in the last 30 days.|400|"actor"|Value sent in, e.g. "aftyershcu22"|"Account has not voted or proxied in the last 30 days."|
|Invalid amount value|amount format is not valid|400|"amount"|Value sent in, e.g. "-100"|"Invalid amount value"|
|Ustake exceeds staked|amount to unstake is greater than the total staked by account|400|"amount"|Value sent in, e.g. "100000000000"|"Cannot unstake more than staked."|
|Invalid fee value|max_fee format is not valid|400|"max_fee"|Value sent in, e.g. "-100"|"Invalid fee value"|
|Fee exceeds maximum|Actual fee is greater than supplied max_fee|400|"max_fee"|Value sent in, e.g. "1000000000"|"Fee exceeds supplied maximum"|
|Insufficient balance|Available (unlocked and unstaked) balance in Staker's account is less than chain fee + *amount*|400|"max_oracle_fee"|Value sent in, e.g. "100000000000"|"Insufficient balance"|
|Invalid TPID|tpid format is not valid|400|"tpid"|Value sent in, e.g. "notvalidfioaddress"|"TPID must be empty or valid FIO address"|
#### Response body
|Parameter|Format|Definition|
|---|---|---|
|status|String|OK if successful|
|fee_collected|Int|Amount of SUFs collected as fee|
##### Example
```
{
  "status": "OK",
  "fee_collected": 2000000000
}
```

# Rationale
There were several versions of staking [discussed and considered](https://fioprotocol.atlassian.net/wiki/spaces/WP/pages/34078744/FIO+Staking). The SRT approach was modeled after [EOSIO REX Implementation](https://github.com/EOSIO/eosio.contracts/issues/117). EOSIO requires a transfer of tokens and issues a transferable REX token. FIOâ€™s implementation does not have to require a transfer because:
* We do not have a requirement for the reward token to be transferable.
* We do have ability to lock tokens in account.

# Implementation
## Token burning
Foundation will burn 25,000,000 FIO Tokens from [FIO Address Giveaways](https://kb.fioprotocol.io/fio-token/token-distribution#tokens-minted-over-time) using retire action being implemented in [FIP-22](fip-0022.md). Bucket designation is pending.

# Backwards Compatibility
No impact on existing functionality.

# Future considerations
None

# Discussion link
https://fioprotocol.atlassian.net/wiki/spaces/WP/pages/34078744/FIO+Staking
