---
fip: 41
title: Enable token locking to existing accounts
status: Draft
type: Functionality
author: Pawel Mastalerz <pawel@fioprotocol.io>
created: 2022-02-09
updated: 2022-02-09
---

# Abstract
This FIP removes the restriction that transfer_locked_tokens can only transfer tokens to a FIO Public Key which has not yet been established as an account.

## Modified actions
|Contract|Action|Endpoint|Description|
|---|---|---|---|
|fio.token|trnsloctoks|/transfer_locked_tokens|Allow transferring of locked tokens to existing accounts.|
|fio.staking|unstakefio|/unstake_fio_tokens|Override _can_vote_ parameter to 1 on unstake.|

# Motivation
When [FIP-6: Transfer locked tokens](https://github.com/fioprotocol/fips/blob/master/fip-0006.md) functionality was built, a decision was made to only allow locked token transfers to brand new accounts. This was done to simplify the implementation and satisfied the use case requirements at that time.

Since then, [FIP-21: FIO Staking](https://github.com/fioprotocol/fips/blob/master/fip-0021.md) has rearchitected the locked token functionality and made it much easier to support transfers of locked tokens to existing accounts.

A new use case (recurring compensation with locked tokens) has also elevated the requirement to support this feature. 

# Specification
## Modified actions
### Transfer locked tokens
Allow transferring of locked tokens to existing accounts.
#### Contract: fio.token
#### Action: *trnsloctoks*
#### End point: /transfer_locked_tokens 
#### Request
* Remove _can_vote_ parameter
#### Processing
* Remove the restriction that transfer_locked_tokens can only transfer tokens to a FIO Public Key which has not yet been established as an account
* Remove 400:Account already exist exception
* All locks created or updated by this call will set _can_vote_ parameter to 1
#### Response
Unchanged

### Unstake FIO Tokens
Override _can_vote_ parameter to 1 on unstake
#### Contract: fio.staking
#### Action: *unstakefio*
#### End point: /unstake_fio_tokens 
#### Request
Unchanged
#### Processing
* When unstake lock is created in the lock table for an account which already has a lock defined, override _can_vote_ parameter to 1.
#### Response
Unchanged

# Rationale
## Removal of _can_vote_
_can_vote_ allows the sender of locked tokens to specify if the locked tokens can be voted before they unlock. The functionality was part of the original [FIP-6](https://github.com/fioprotocol/fips/blob/master/fip-0006.md) which was designed to established the locks on account creation and assumed the locks would not be modified in the future. As a result there is only one lock entry per account and one of its parameters is _can_vote_, which applies to all tokens locked in that account.

[FIP-21](https://github.com/fioprotocol/fips/blob/master/fip-0021.md) introduced the ability to add new periods to existing lock entry but failed to properly consider the impact of the _can_vote_ parameter on tokens locked as a result of unstake. This causes the following behaviour to exist on Mainnet:
* Alice uses _trnsloctoks_ to send Bob 100 FIO tokens and specifies _can_vote:0_
* Bob acquires 1000 FIO tokens and stakes them
* Bob unstakes 1000 FIO tokens which causes a new period be inserted into the lock table. However, because _can_vote_ applies to all tokens locked and was previously set to 0, Bob's unstaked tokens are not votable until the unstake lock expires (7 days). This is not what was intended.

In addition, enabling token locking to existing accounts as proposed in this FIP, would further exacerbate the problem.

As a result, this FIP proposes the elimination of _can_vote_ parameter from _trnsloctoks_ altogether. The value would be left in the table to avoid table migration and vote checks would continue to evaluate _can_vote_ parameter to minimize code changes but _can_vote_ parameter would effectively always be set to 1, which means locked tokens are always allowed to vote.

# Implementation
TBD

# Backwards Compatibility
Modification to _trnsloctoks_ parameters would break all existing integrations and an Advisory will be issued as soon as the FIP is Accepted and when its launched on Mainnet. However, given the purpose of this action, it's very unlikely it has been implemented by any integrator.

# Future considerations
None

# Discussion link
https://fioprotocol.atlassian.net/wiki/spaces/FC/pages/473104421/Enhanced+permissions
